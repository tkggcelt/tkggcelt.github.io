<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Shell命令学习之awk | 闲言逸语</title>

    <link href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">

    <!--========================== style css ==========================-->
    <!--link rel="stylesheet" href="/css/main.css"-->
    <link href="/css/style.css" rel="stylesheet">
    <!--============================ fevicon ===============================-->
    <link rel="shortcut icon" type="image/png" href="/img/fev-icon.ico">
    <!--========================== responsive css ==========================-->
    <link href="/css/responsive.css" rel="stylesheet">
    <!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!--========================== Main jQuery ==========================-->
    <script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <!--========================== Bootstrap js ==========================-->
    <script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!--========================== Custom js ==========================-->  
    <script src="/js/jquery.sticky.js"></script>
</head>
<body class="index-one">
    <!--========================== preloader ==========================-->
<div id="preloader"></div>
<!--========================== menu-area-start ==========================-->
<section class="menu-area">
    <div class="container">
        <div class="row">
            <div class="menu-area-content clearfix">
                <nav class="navbar" style="margin-bottom:0 !important;">
                    <div class="container-fluid">
                        <!-- Brand and toggle get grouped for better mobile display -->
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false" style="margin-top:8px;margin-left:10px">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand" href="#">闲言逸语</a>
                        </div>
                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                            <ul class="nav navbar-nav">
                                
                                <li><a href="/">首页</a></li>
                                
                                <li><a href="/page/category.html">栏目</a></li>
                                
                                <li><a href="/page/tag.html">标签</a></li>
                                
                                <li><a href="/page/about.html">关于</a></li>
                                
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>

    <section class="categories-area">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="category-border-content">
                    <div class="category-detail category">
                        
                            <div id="cim33yp450000e69kst5k80sb" class="carousel slide" data-ride="carousel">
                                <div class="carousel-inner" role="listbox">
                                    
                                        
                                            <div class="item active">
                                        
                                                <div class="category-img">
                                                    <img src="/postimg/default/default-4.jpg">
                                                </div>
                                            </div>
                                    
                                        
                                            <div class="item">
                                        
                                                <div class="category-img">
                                                    <img src="/postimg/default/default-5.jpg">
                                                </div>
                                            </div>
                                    
                                        
                                            <div class="item">
                                        
                                                <div class="category-img">
                                                    <img src="/postimg/default/default-6.jpg">
                                                </div>
                                            </div>
                                    
                                </div>
                                <a class="left slide-control photograph" href="#cim33yp450000e69kst5k80sb" role="button" data-slide="prev"><i class="fa fa-angle-right"></i></a>
                                <a class="right slide-control photograph" href="#cim33yp450000e69kst5k80sb" role="button" data-slide="next"><i class="fa fa-angle-left"></i></a>
                            </div>
                        

                        <div class="category-text read-more clearfix">
                            
                            <h4 class="post-content-title"><a href="/2016/03/21/awk/">Shell命令学习之awk</a></h4>
                            <div class="clearfix post-content-info">
                                <a href="#" class="art">
                                    
                                        <span class="label label-default">shell</span>
                                    
                                </a>
                                <span class="art">
                                    <span class="label label-default">3月 23, 2016</span>
                                </span>
                            </div>
                            
                            <div class="post-content" itemprop="articleBody">
                                <p>awk是一个非常棒的数据处理工具，相比于sed常常作用于一整行的处理，awk则比较倾向于将一行分成数个『字段』来处理。因此，相当于适合处理小型的数据。</p>
<h1 id="awk运行模式"><a href="#awk运行模式" class="headerlink" title="awk运行模式"></a>awk运行模式</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">awk <span class="string">'条件类型1&#123;动作1&#125; 条件类型2&#123;动作2&#125; ...'</span> filename</span><br></pre></td></tr></table></figure>
<ul>
<li>awk后面接两个<code>单引号</code>并加上<code>大括号{}</code>来设置想要对数据进行的处理动作。</li>
<li>awk可以处理后续接的文件，也可以读取来自前一个命令的standard output。</li>
<li>awk主要是处理每一行的字段内的数据，而默认的字段的分隔符为<code>空格符</code>或<code>[Tab]键</code></li>
</ul>
<blockquote>
<p>注意，awk必须使用单引号<code>&#39;</code>，在条件和动作中，均不可包含单引号，若有需求需要用双引号</p>
</blockquote>
<h1 id="awk参数"><a href="#awk参数" class="headerlink" title="awk参数"></a>awk参数</h1><p>在awk的条件类型以及动作类型中，会涉及到各种参数，通常参数类型分两种。</p>
<h3 id="字符串分割参数"><a href="#字符串分割参数" class="headerlink" title="字符串分割参数"></a>字符串分割参数</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">last -n 3 &lt;== 仅取出前三行，输出如下</span><br><span class="line"><span class="comment"># root pts/1 192.168.1.1 Tue Feb 10 11:21 still logged in</span></span><br><span class="line"><span class="comment"># root pts/1 192.168.1.1 Tue Feb 10 11:21 - 02:28 (01:48)</span></span><br><span class="line"><span class="comment"># root pts/1 192.168.1.1 Tue Feb 10 11:21 - 02:28 (01:48)</span></span><br><span class="line"><span class="comment">#若需要取出登录帐号以及IP，且二者之间用tab隔开</span></span><br><span class="line">last -n 3 | awk <span class="string">'&#123;print $1 "\t" $3&#125;'</span> </span><br><span class="line"><span class="comment"># 输出如下</span></span><br><span class="line"><span class="comment"># root 192.168.1.1</span></span><br><span class="line"><span class="comment"># root 192.168.1.1</span></span><br><span class="line"><span class="comment"># root 192.168.1.1</span></span><br></pre></td></tr></table></figure>
<p>字段的分割默认以空格键或者[Tab]键。分割完毕后，每一行的每个字段都是有变量名称的，例如$1、$2等。<br>所由于切割后root是第一个，故$1就是root、192.168.1.1就是$2。</p>
<blockquote>
<p>$0参数代表切割前的一整行数据</p>
</blockquote>
<h3 id="内建参数"><a href="#内建参数" class="headerlink" title="内建参数"></a>内建参数</h3><table>
<thead>
<tr>
<th>参数名称</th>
<th>代表意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>NF</td>
<td>每一行(也即$0)拥有的字段总数(切割后的个数)</td>
</tr>
<tr>
<td>NR</td>
<td>目前awk所处理的第几行数据</td>
</tr>
<tr>
<td>FS</td>
<td>目前的分割字符，默认是空格键</td>
</tr>
</tbody>
</table>
<h1 id="awk逻辑运算符"><a href="#awk逻辑运算符" class="headerlink" title="awk逻辑运算符"></a>awk逻辑运算符</h1><table>
<thead>
<tr>
<th>运算符</th>
<th>代表意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>></td>
<td>大于</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>>=</td>
<td>大于或等于</td>
</tr>
<tr>
<td>&lt;=</td>
<td>小于或等于</td>
</tr>
<tr>
<td>==</td>
<td>等于</td>
</tr>
<tr>
<td>!=</td>
<td>不等于</td>
</tr>
</tbody>
</table>
<blockquote>
<p>在awk若要给变量赋值，则用<code>等号=</code>即可</p>
</blockquote>
<h1 id="awk示例"><a href="#awk示例" class="headerlink" title="awk示例"></a>awk示例</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd | awk <span class="string">'&#123;FS=":"&#125; $3 &lt; 10 &#123;print $1 "\t" $3&#125;'</span></span><br><span class="line"><span class="comment">#输出如下：</span></span><br><span class="line"><span class="comment"># root:x:0:0:root:/root:/bin/bash</span></span><br><span class="line"><span class="comment"># bin      1</span></span><br><span class="line"><span class="comment"># daemon   2</span></span><br><span class="line"><span class="comment"># ...省略</span></span><br></pre></td></tr></table></figure>
<p>看到上例应该有疑问，为何第一行输出与其他行不一样。因为在读入第一行时，那些变量$1,$2..默认还是以空格来分割的，所以虽然定了<code>FS=&quot;:&quot;</code>，但是却只能在第二行开始才生效。<br>若要让第一行生效，命令如下：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd | awk <span class="string">'BEGIN &#123;FS=":"&#125; $3 &lt; 10 &#123;print $1 "\t" $3&#125;'</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>在awk中，不仅有<code>BEGIN</code>，也有<code>END</code></p>
</blockquote>
<p>再看一个复杂的例子：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#假设有一个文件，内容如下：</span></span><br><span class="line">Name    1st     2nd     3th</span><br><span class="line">VBird   23000   24000   25000</span><br><span class="line">DMTsai  21000   20000   23000</span><br><span class="line">Bird2   43000   42000   41000</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[work@www ~]$ cat pay.txt | \</span><br><span class="line">&gt; awk <span class="string">'NR==1&#123;printf "%10s %10s %10s %10s %10s\n",$1,$2,$3,$4,"total"&#125;</span><br><span class="line">NR&gt;=2&#123;total = $2 + $3 + $4 </span><br><span class="line">printf "%10s %10d %10d %10d %10.2f\n",$1,$2,$3,$4,total&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出如下</span></span><br><span class="line"><span class="comment"># Name    1st     2nd     3th    total</span></span><br><span class="line"><span class="comment"># VBird   23000   24000   25000  72000.00</span></span><br><span class="line"><span class="comment"># DMTsai  21000   20000   23000  64000.00</span></span><br><span class="line"><span class="comment"># Bird2   43000   42000   41000  126000.00</span></span><br></pre></td></tr></table></figure>
<p>在上例中，有以下几个点：</p>
<ul>
<li>所有awk的动作，即在{}内的动作，如果有多个命令辅助，可以使用<code>分号;</code>间隔，或者直接以<code>[Enter]</code>键来隔开命令</li>
<li>与bash、shell的变量不同，在awk中变量可以直接使用，不需要加\$符号</li>
<li>在awk的输出格式中，常常会以<code>printf</code>来辅助</li>
<li>在awk的动作{}内，也是支持<code>if(条件)</code>的</li>
</ul>
<p>用if来改写上面的命令：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[work@www ~]$ cat pay.txt | \</span><br><span class="line">&gt; awk <span class="string">'&#123;if(NR==1)printf "%10s %10s %10s %10s %10s\n",$1,$2,$3,$4,"total"&#125;</span><br><span class="line">NR&gt;=2&#123;total = $2 + $3 + $4</span><br><span class="line">printf "%10s %10d %10d %10d %10.2f\n",$1,$2,$3,$4,total&#125;'</span></span><br></pre></td></tr></table></figure></p>

                            </div>
                            <div class="read-more-more clearfix">
                                <div class="tag floatleft">
                                    <span><i class="fa fa-tags"></i>Tags</span>
                                    
                                        
                                            <a href="/tags/linux/">linux</a>
                                        
                                            <a href="/tags/shell/">shell</a>
                                        
                                            <a href="/tags/awk/">awk</a>
                                        
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-12">
                <div class="sidebar-widget">
                    

    
        
    
        
    
        
            
            
            
        
    

    
        
    
        
    

    
        
    




    
        
        
        
        
        
            
        
        
    

    
        
        
        
        
        
            
        
        
    
        
        
        
        
        
        
            
        
    
        
        
        
        
            
        
        
        
            
        
    
        
        
        
        
            
        
            
        
        
        
            
        
    
        
        
            
        
        
            

    
        
        
            
        
        
            
        
        
            
        
        
            
        
        
            
        
        
            



<div class="row">
    <div class="col-md-12 col-sm-12">
        <div class="popular-post-border-content">
            <div class="popular-post-content">
                <div class="popular-post-title">
                    <h4>相关文章</h4>
                </div>

                
                
                <div class="popular-post-single">
                    <div class="popular-post-single-text">
                        <span>3月 23, 2016</span>
                        <h4><a href="/2016/03/23/shell-cut-grep/">shell-cut-grep</a></h4>
                        <p>
                            
                            
                            cut和grep都是以行为单位的的文本处理命令，放在一起讲解。
cut命令cut以行为单位处理文本数据，将一段信息中的某
                        </p>
                    </div>
                </div>
                
                
                <div class="popular-post-single">
                    <div class="popular-post-single-text">
                        <span>3月 23, 2016</span>
                        <h4><a href="/2016/03/23/shell-regx/">Shell命令学习之正则表达式</a></h4>
                        <p>
                            
                            
                            正则表达式在Shell的日常使用中具有举足轻重的地位，合理运用它，能极大提高工作效率，这里对正则表达式做一个简单易懂的介
                        </p>
                    </div>
                </div>
                
                
                <div class="popular-post-single">
                    <div class="popular-post-single-text">
                        <span>3月 23, 2016</span>
                        <h4><a href="/2016/03/23/shell-sed/">Shell命令学习之sed</a></h4>
                        <p>
                            
                            
                            sed是一个管道命令，可以分析standard input的，而且sed还可以将数据进行替换、删除、新增、选取特定行等功
                        </p>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
</div>

                </div>
                <div class="sidebar-widget">
                    <div class="row">
    <div class="col-md-12 col-sm-12">
        <div class="popular-post-border-content">
            <div class="popular-post-content">
                <div class="popular-post-title">
                    <h4>最新文章</h4>
                </div>
                
                    
                <div class="popular-post-single">
                    <div class="popular-post-single-text">
                        <span>3月 23, 2016</span>
                        <h4><a href="/2016/03/21/awk/">Shell命令学习之awk</a></h4>
                        <p>
                            
                                <a href="/2016/03/21/awk/"><img src="/postimg/default/default-4.jpg" alt=""></a>
                            
                            
                            awk是一个非常棒的数据处理工具，相比于sed常常作用于一整行的处理，awk则比较倾向于将一行分成数个『字段』来处理。因
                        </p>
                    </div>
                </div>
                
                    
                <div class="popular-post-single">
                    <div class="popular-post-single-text">
                        <span>3月 22, 2016</span>
                        <h4><a href="/2016/03/18/hello-world/">Hello World</a></h4>
                        <p>
                            
                            
                            # rewrite`s rules for wordpress pretty urlLoadModule rewrite
                        </p>
                    </div>
                </div>
                
                    
                <div class="popular-post-single">
                    <div class="popular-post-single-text">
                        <span>3月 23, 2016</span>
                        <h4><a href="/2016/03/23/gitbook-quickstart/">gitbook快速入门</a></h4>
                        <p>
                            
                            
                            Modern book format and toolchain using Git and Markdown，这是gi
                        </p>
                    </div>
                </div>
                
                    
                <div class="popular-post-single">
                    <div class="popular-post-single-text">
                        <span>3月 23, 2016</span>
                        <h4><a href="/2016/03/23/yaf-install/">Mac下yaf的安装</a></h4>
                        <p>
                            
                            
                            Yaf，全称 Yet Another Framework，是一个C语言编写的PHP框架，是一个以PHP扩展形式提供的PH
                        </p>
                    </div>
                </div>
                
                    
                <div class="popular-post-single">
                    <div class="popular-post-single-text">
                        <span>3月 23, 2016</span>
                        <h4><a href="/2016/03/23/shell-cut-grep/">shell-cut-grep</a></h4>
                        <p>
                            
                            
                            cut和grep都是以行为单位的的文本处理命令，放在一起讲解。
cut命令cut以行为单位处理文本数据，将一段信息中的某
                        </p>
                    </div>
                </div>
                
                    
                        
                    
                        
                    
                        
                    
                        
            </div>
        </div>
    </div>
</div>
                </div>
            </div>
        </div>
    </div>
</section>

    <section class="footer-bottom-area">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="footer-bottom-text text-center">
                    <p>Blog Design 2016 &copy;All Rights reserved</p>
                    <p>Designed by <span><a href="https://github.com/tkggcelt">tkggcelt</a></span></p>
                </div>
            </div>
        </div>
    </div>
</section>
<script src="/js/active.js"></script>
<script>
    $(window).load(function() {
        $('#preloader').fadeOut('slow', function() {
            $(this).remove();
        });
    });
</script>
</body>
</html>